<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歌曲歌单</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
        }
        #songList {
            list-style-type: none;
            padding: 0;
        }
        .songButton {
            background: #fff;
            padding: 10px;
            border: none;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 5px;
            flex: 1 0 18%; /* 每行五首歌 */
        }
        .songButton:hover {
            background-color: #e0e0e0;
        }
        .checkbox {
            margin-right: 5px;
        }
        .moveButton {
            margin-top: 10px;
            padding: 10px;
            border: none;
            background-color: #007BFF;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        .moveButton:hover {
            background-color: #0056b3;
        }
        .moveContainer {
            display: none;
            margin-top: 10px;
        }
        .songRow {
            display: flex;
            flex-wrap: wrap; /* 允许换行 */
            margin-bottom: 10px; /* 每组之间的间距 */
        }
        .songCategory {
            margin-bottom: 20px; /* 分类之间的间距 */
        }
    </style>
</head>
<body>

    <h1>我的歌曲歌单</h1>
    <div id="addSongForm">
        <input type="text" id="songInput" placeholder="输入歌曲名称">
        <button onclick="addSong()">添加歌曲</button>
        <input type="file" id="fileInput" accept=".txt" onchange="loadSongsFromFile(event)">
    </div>

    <button onclick="toggleMoveContainer()" class="moveButton">移动选中歌曲</button>
    <div id="moveContainer" class="moveContainer">
        <label for="moveSelect">选择目标分类:</label>
        <select id="moveSelect">
            <option value="">选择目标分类...</option>
            <option value="中文歌">中文歌</option>
            <option value="英文歌">英文歌</option>
            <option value="日文歌">日文歌</option>
        </select>
        <button onclick="moveSelectedSongs()">确认移动</button>
    </div>

    <label for="viewOption">查看选项:</label>
    <select id="viewOption" onchange="displaySongs()">
        <option value="all">查看所有歌曲</option>
        <option value="chinese">只查看中文歌</option>
    </select>

    <button onclick="exportSongs()" class="moveButton">导出歌曲</button>

    <ul id="songList"></ul>

    <script>
        const songs = {
            "中文歌": {},
            "英文歌": [],
            "日文歌": []
        };

        function addSong() {
            const songInput = document.getElementById('songInput');
            const songName = songInput.value.trim();

            if (songName) {
                const category = detectLanguage(songName);
                addSongToCategory(songName, category);
                displaySongs();
                songInput.value = ''; // 清空输入框
            } else {
                alert('请输入歌曲名称');
            }
        }

        function detectLanguage(songName) {
            const chineseRegex = /[\u4e00-\u9fa5]/; // 中文字符范围
            const englishRegex = /^[A-Za-z\s]+$/; // 英文字母
            const japaneseRegex = /[\u3040-\u30ff\u4e00-\u9faf]/; // 日文字符范围

            if (chineseRegex.test(songName)) {
                return "中文歌";
            } else if (englishRegex.test(songName)) {
                return "英文歌";
            } else if (japaneseRegex.test(songName)) {
                return "日文歌";
            } else {
                return "未知语言"; // 如果不符合任何语言
            }
        }

        function loadSongsFromFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const contents = e.target.result;
                    const lines = contents.split('\n');
                    lines.forEach(line => {
                        const songName = line.trim();
                        if (songName) {
                            const category = detectLanguage(songName);
                            addSongToCategory(songName, category);
                        }
                    });
                };
                reader.readAsText(file);
            }
        }

        function addSongToCategory(songName, category) {
            if (category === "中文歌") {
                const length = songName.length > 7 ? '多字' : songName.length;
                if (!songs[category][length]) {
                    songs[category][length] = [];
                }
                songs[category][length].push(songName);
            } else if (category !== "未知语言") {
                songs[category].push(songName);
            }
            displaySongs();
        }

        function displaySongs() {
            const songList = document.getElementById('songList');
            songList.innerHTML = ''; // 清空列表
            const viewOption = document.getElementById('viewOption').value;

            for (const category in songs) {
                if (viewOption === "chinese" && category !== "中文歌") {
                    continue; // 如果选择只查看中文歌，则跳过其他语言
                }

                const categoryHeader = document.createElement('div');
                const lengthHeader = document.createElement('h3');
                lengthHeader.textContent = `${category}:`;
                categoryHeader.appendChild(lengthHeader);
                songList.appendChild(categoryHeader);

                if (category === "中文歌") {
                    for (const length in songs[category]) {
                        const lengthHeader = document.createElement('h4');
                        lengthHeader.textContent = `${length} 字歌曲:`;
                        songList.appendChild(lengthHeader);

                        const songRow = document.createElement('div');
                        songRow.className = 'songRow';

                        songs[category][length].forEach(song => {
                            const songElement = createSongElement(song, category);
                            songRow.appendChild(songElement);
                        });

                        songList.appendChild(songRow);
                    }
                } else {
                    const songRow = document.createElement('div');
                    songRow.className = 'songRow';

                    songs[category].forEach(song => {
                        const songElement = createSongElement(song, category);
                        songRow.appendChild(songElement);
                    });

                    songList.appendChild(songRow);
                }
            }
        }

        function createSongElement(song, category) {
            const container = document.createElement('div');

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'checkbox';
            checkbox.value = song;

            const button = document.createElement('button');
            button.textContent = song;
            button.className = 'songButton';

            button.onclick = function() {
                const confirmCopy = confirm(`确定要复制 "${song}" 吗？`);
                if (confirmCopy) {
                    navigator.clipboard.writeText(song).then(() => {
                        alert(`"${song}" 已复制到剪贴板`);
                    });
                }
            };

            button.oncontextmenu = function(event) {
                event.preventDefault();
                if (confirm(`确定要删除 "${song}" 吗？`)) {
                    deleteSong(song, category);
                }
            };

            container.appendChild(checkbox);
            container.appendChild(button);
            return container;
        }

        function toggleMoveContainer() {
            const moveContainer = document.getElementById('moveContainer');
            moveContainer.style.display = moveContainer.style.display === 'none' || moveContainer.style.display === '' ? 'block' : 'none';
        }

        function moveSelectedSongs() {
            const moveSelect = document.getElementById('moveSelect');
            const newCategory = moveSelect.value;

            if (!newCategory) {
                alert('请选择目标分类');
                return;
            }

            const checkboxes = document.querySelectorAll('.checkbox:checked');
            checkboxes.forEach(checkbox => {
                const song = checkbox.value;
                const category = detectLanguage(song);
                deleteSong(song, category);
                addSongToCategory(song, newCategory);
            });

            moveSelect.value = ""; // 重置选择
            displaySongs();
        }

        function deleteSong(song, category) {
            if (category === "中文歌") {
                const length = song.length > 7 ? '多字' : song.length;
                songs[category][length] = songs[category][length].filter(s => s !== song);
                if (songs[category][length].length === 0) {
                    delete songs[category][length];
                }
            } else {
                songs[category] = songs[category].filter(s => s !== song);
            }
            displaySongs();
        }

        function exportSongs() {
            let allSongs = [];

            for (const category in songs) {
                if (category === "中文歌") {
                    for (const length in songs[category]) {
                        allSongs = allSongs.concat(songs[category][length]);
                    }
                } else {
                    allSongs = allSongs.concat(songs[category]);
                }
            }

            const blob = new Blob([allSongs.join('\n')], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'songs.txt';
            link.click();
            URL.revokeObjectURL(link.href);
        }
    </script>

</body>
</html>
